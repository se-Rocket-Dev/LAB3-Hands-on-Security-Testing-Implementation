# LAB3: เอกสารคู่มือการทดสอบความปลอดภัยเว็บแอปพลิเคชัน
 
## Security Testing Guide & Report Template

Team: กลุ่ม 6

1. ชื่อ-สกุล: พลพัต ทรวงหิรัญ
รหัสนักศึกษา: 66543210020-4

2. ชื่อ-สกุล: นายสุรพัศ  สุภาพ
รหัสนักศึกษา: 66543210033-7

วันที่ทดสอบ: 14/09/2025
เวลาที่ใช้: 3 วัน

การเตรียมความพร้อม (Pre-Testing Checklist)

✅  ตรวจสอบระบบ

✅  ติดตั้ง Node.js และ SQL Server เรียบร้อย

✅  สร้างฐานข้อมูลและ import ข้อมูลทดสอบแล้ว

✅  Vulnerable Server (port 3000) ทำงานได้

✅  Secure Server (port 3001) ทำงานได้

✅  Frontend files เปิดได้ในเบราว์เซอร์

✅  เครื่องมือทดสอบ (Browser Developer Tools) พร้อมใช้


---

# Part 1: การทดสอบ Vulnerable Version

เอกสารนี้สรุปขั้นตอนการทดสอบและหลักฐานสำหรับช่องโหว่ **SQL Injection** บนเวอร์ชันที่ตั้งใจทำให้มีช่องโหว่ (Vulnerable Version) เพื่อการศึกษาและปรับปรุงความปลอดภัยเท่านั้น

> ⚠️ ทดสอบเฉพาะสภาพแวดล้อมที่ควบคุมได้ (local / lab) ห้ามใช้กับระบบที่ไม่ได้รับอนุญาต

---

## Test Case 1.1: SQL Injection — Login Bypass

**วัตถุประสงค์**  
ทดสอบการ bypass ระบบล็อกอินด้วยการสอดแทรกคำสั่ง SQL

### ขั้นตอนการทดสอบ
1. เปิดไฟล์ `index.html` (Vulnerable Version)  
2. ไปยังส่วน **Login**  
3. กรอกข้อมูล:
   - **Username:** `admin'; --`
   - **Password:** `anything`
4. กดปุ่ม **Login**

### บันทึกผลการทดสอบ

| ผลลัพธ์ที่คาดหวัง                                 | ผลลัพธ์จริง (สรุป) | สถานะ |
|----------------------------------------------------|---------------------|-------|
| ระบบอนุญาตให้ Login ได้โดยไม่ตรวจสอบรหัสผ่าน      |  ระบบ bypass login เพราะว่ามี -- หลัง admin ทำให้ทุก query ที่อยู่หลัง -- ไป จะถูกมองข้ามเพราะเห็นเป็น comments จึงข้ามการตรวจสอบบัญชีไป       |       |

- [✅] สำเร็จ  
- [ ] ล้มเหลว  

**หลักฐาน (Screenshots):**  
แนบไฟล์รูป: `docs/screenshots/tc1-1.png`  
ตัวอย่างการแทรกรูปใน Markdown:  
```md
![Login Bypass Evidence](docs/screenshots/tc1-1.png)
```

### วิเคราะห์และความคิดเห็น
- **สาเหตุ:** ระบบนำค่า input ไปประกอบเป็นสตริง SQL ตรง ๆ ทำให้ `--` คอมเมนต์ส่วนเงื่อนไขรหัสผ่านออกไป
- **ผลกระทบ:** ผู้โจมตีข้ามการตรวจสอบรหัสผ่าน เข้าสู่ระบบในนามผู้ใช้ `admin` ได้
- **แนวทางป้องกัน:** ใช้ **Prepared Statements / Parameterized Queries**, ตรวจสอบ input แบบ allow‑list, จำกัดสิทธิ์ DB (Least Privilege), ปิด error detail

---

## Test Case 1.2: SQL Injection — Data Extraction

**วัตถุประสงค์**  
ทดสอบการดึงข้อมูลผู้ใช้ด้วยเทคนิค **UNION attack**

### ขั้นตอนการทดสอบ
1. ไปยังส่วน **Product Search**  
2. กรอกข้อมูล (Payload):
   ```sql
   ' UNION SELECT id,username,password FROM Users; --
   ```
3. กดปุ่ม **Search**

### บันทึกผลการทดสอบ

| ผลลัพธ์ที่คาดหวัง                        | ผลลัพธ์จริง (สรุป) | สถานะ |
|-------------------------------------------|---------------------|-------|
| แสดงข้อมูลผู้ใช้ (เช่น username/password) |                     |       |

- [ ] สำเร็จ  
- [ ] ล้มเหลว  

**ข้อมูลที่ได้รับ (ถ้ามี):**
- ชื่อผู้ใช้:  
- รหัสผ่าน:  
- อื่น ๆ:  

**หลักฐาน (Screenshots):**  
แนบไฟล์รูป: `docs/screenshots/tc1-2.png`  
ตัวอย่างการแทรกรูปใน Markdown:  
```md
![Union Data Extraction Evidence](docs/screenshots/tc1-2.png)
```

### วิเคราะห์และความคิดเห็น
- **สาเหตุ:** Query ไม่ผูกพารามิเตอร์ ทำให้ใช้ `UNION` รวมผลลัพธ์จากตาราง `Users` ได้
- **ผลกระทบ:** รั่วไหลข้อมูลอ่อนไหวของผู้ใช้ และนำไปสู่การโจมตีขั้นต่อไปได้
- **แนวทางป้องกัน:** ใช้ **Prepared Statements**, validate/normalize input, จำกัดสิทธิ์ DB, ปิด error detail, เพิ่ม automated tests + SAST/DAST

---

## ภาคผนวก: ข้อควรปฏิบัติด้านความปลอดภัย (สรุปย่อ)
- ใช้ **Parameterized Queries** ทุกกรณี แทนการต่อสตริง SQL
- ทำ **Input Validation** แบบ allow‑list และ escape เมื่อจำเป็น
- ออกแบบ **Least Privilege** ให้กับบัญชีฐานข้อมูลที่แอปใช้งาน
- จัดการ error message ให้เป็นมิตรต่อผู้ใช้แต่ไม่เปิดเผยโครงสร้างภายใน
- เพิ่ม test สำหรับ payload ที่พบบ่อย และตั้ง CI ให้สแกนด้วย SAST/DAST อย่างสม่ำเสมอ

---

## เวอร์ชันของเอกสาร
- วันที่ปรับปรุงล่าสุด: 2025-09-14
---

## Test Case 1.3: Cross-Site Scripting (XSS)

**วัตถุประสงค์**  
ทดสอบการแทรก JavaScript code ผ่าน comment

### ขั้นตอนการทดสอบ
1. Login ด้วย user ปกติ (`john/password`)
2. ไปยังส่วน **Comments**
3. กรอก comment:
   ```html
   <script>alert('XSS Attack!');</script>
   ```
4. Submit comment

### บันทึกผลการทดสอบ

| ผลลัพธ์ที่คาดหวัง                    | ผลลัพธ์จริง (สรุป) | สถานะ |
|--------------------------------------|---------------------|-------|
| JavaScript execute และแสดง alert     |                     |       |

- [ ] สำเร็จ  
- [ ] ล้มเหลว

---

### ทดสอบ XSS เพิ่มเติม

**Test 1.3.1: Cookie Stealing Simulation**
- Payload:
  ```html
  <script>alert('cookie: ' + document.cookie);</script>
  ```
- ผลลัพธ์: _____________________________

**Test 1.3.2: DOM Manipulation**
- Payload:
  ```html
  <img src=x onerror="alert('XSS via IMG tag')">
  ```
- ผลลัพธ์: _____________________________

---

### วิเคราะห์และความคิดเห็น

วิเคราะห์ความเสี่ยงจาก XSS:
- ความเสี่ยงจากการโจรกรรม session/cookie
- การ redirect ไปเว็บอันตราย
- การแก้ไขหน้าจอ/ DOM ของเว็บเพจ
- ผลกระทบต่อผู้ใช้งานในระบบ
---

## Test Case 1.4: Insecure Direct Object Reference (IDOR)

**วัตถุประสงค์**  
ทดสอบการเข้าถึงข้อมูลผู้ใช้อื่นโดยไม่ได้รับอนุญาต

### ขั้นตอนการทดสอบ
1. Login ด้วย `john/password`  
2. ไปยังส่วน **User Profile**  
3. ลองเปลี่ยน **User ID** เป็น `1`, `2`, `3`  
4. สังเกตข้อมูลที่ได้รับ

### บันทึกผลการทดสอบ

| User ID | ข้อมูลที่แสดง | สามารถเข้าถึงได้ |
|--------:|----------------|------------------|
| 1 |  | ○ ใช่  ○ ไม่ |
| 2 |  | ○ ใช่  ○ ไม่ |
| 3 |  | ○ ใช่  ○ ไม่ |

### วิเคราะห์และความคิดเห็น
วิเคราะห์ที่มาของปัญหา IDOR:
- ข้อมูลที่ผู้ใช้ไม่ควรเห็นแต่กลับเข้าถึงได้  
- ความสอดคล้อง/ความเป็นเจ้าของในแต่ละกรณี  
- วิธีการที่ใช้ป้องกันไม่ให้ข้อมูลรั่วไหลในอนาคต  

---

# Part 2: การทดสอบ Secure Version

## Test Case 2.1: SQL Injection Protection

**วัตถุประสงค์**  
ทดสอบมาตรการป้องกัน SQL Injection

### ขั้นตอนการทดสอบ
1. เปิด `secure.html` (Secure Version)  
2. ทดสอบ payloads เดียวกับฝั่ง vulnerable version

### บันทึกผลการทดสอบ

| Payload | ผลลัพธ์ | การป้องกัน |
|---|---|---|
| `admin'; --` |  | ○ ถูกบล็อก  ○ ผ่านได้ |
| `' UNION SELECT * FROM Users; --` |  | ○ ถูกบล็อก  ○ ผ่านได้ |
| `'; DROP TABLE Products; --` |  | ○ ถูกบล็อก  ○ ผ่านได้ |

### วิธีการป้องกันที่สังเกตได้:
- [ ] Input validation  
- [ ] Prepared statements  
- [ ] Error message ที่ไม่เปิดเผยรายละเอียด  
- [ ] อื่นๆ: ____________

### วิเคราะห์และความคิดเห็น
เปรียบเทียบกับ vulnerable version:
- ความแตกต่างในการตรวจสอบ input  
- วิธีการป้องกันที่มีประสิทธิภาพ  
- ข้อเสนอแนะสำหรับการพัฒนาเพิ่มเติม  

---

## Test Case 2.2: XSS Protection

**วัตถุประสงค์**  
ทดสอบมาตรการป้องกัน Cross-Site Scripting

### ขั้นตอนการทดสอบ
1. Login ในระบบ **secure version**  
2. ทดสอบ XSS payloads ในช่อง comment

### บันทึกผลการทดสอบ

| Payload | ผลลัพธ์ที่แสดง | Script Execute หรือไม่ |
|---|---|---|
| `<script>alert('XSS')</script>` |  | ○ ใช่  ○ ไม่ |
| `<img src=x onerror=alert('XSS')>` |  | ○ ใช่  ○ ไม่ |
| `<svg onload=alert('XSS')>` |  | ○ ใช่  ○ ไม่ |

### วิธีการป้องกันที่สังเกตได้:
- [ ] HTML encoding  
- [ ] Input sanitization  
- [ ] Content validation  
- [ ] CSP (Content Security Policy)  
- [ ] อื่นๆ: ____________

### วิเคราะห์และความคิดเห็น
การป้องกัน XSS ที่มีประสิทธิภาพ:
- วิธีการ encoding ที่ใช้  
- ผลต่างจาก vulnerable version  
- ความปลอดภัยของผู้ใช้งานโดยรวม  

---

## Test Case 2.3: IDOR Protection

**วัตถุประสงค์**  
ทดสอบมาตรการป้องกัน Insecure Direct Object Reference

### ขั้นตอนการทดสอบ
1. Login ด้วย user ปกติ  
2. ทดสอบการเข้าถึง **profile ของผู้ใช้อื่น**  
3. ทดสอบด้วย **admin account** (ถ้ามี)

### บันทึกผลการทดสอบ

| User Account | Target User ID | สามารถเข้าถึงได้ | Error Message |
|---|---:|---|---|
| john (user) | 1 | ○ ใช่  ○ ไม่ |  |
| john (user) | 3 | ○ ใช่  ○ ไม่ |  |
| admin | 2 | ○ ใช่  ○ ไม่ |  |

### วิธีการป้องกันที่สังเกตได้:
- [ ] JWT token validation  
- [ ] Authorization checks  
- [ ] Role-based access control  
- [ ] อื่นๆ: ____________

### วิเคราะห์และความคิดเห็น
ประสิทธิภาพของมาตรการป้องกัน IDOR:
- ความแตกต่างระหว่าง user และ admin  
- ความเหมาะสมของ error messages  
- ระดับความปลอดภัยที่ได้รับ  

---

# Part 3: การทดสอบความปลอดภัยเพิ่มเติม

## Test Case 3.1: Rate Limiting

**วัตถุประสงค์**  
ทดสอบการจำกัดจำนวนคำขอ (request)

### ขั้นตอนการทดสอบ
1. ใช้ **Security Testing Dashboard** ใน secure version  
2. กดปุ่ม **Run Rate Limit Test**  
3. สังเกตผลลัพธ์

### บันทึกผลการทดสอบ

| Attempt | Response Status | Rate Limited |
|---:|---|---|
| 1 |  | ○ ใช่  ○ ไม่ |
| 2 |  | ○ ใช่  ○ ไม่ |
| 3 |  | ○ ใช่  ○ ไม่ |
| 4 |  | ○ ใช่  ○ ไม่ |
| 5 |  | ○ ใช่  ○ ไม่ |
| 6 |  | ○ ใช่  ○ ไม่ |

**จำนวน attempts ก่อนถูกบล็อก:** ________

### วิเคราะห์และความคิดเห็น
ประสิทธิภาพของ Rate Limiting:
- ความเหมาะสมของจำนวนที่กำหนดไว้  
- ผลกระทบต่อ user experience  
- การป้องกัน brute force attacks  

---

## Test Case 3.2: Authentication & Authorization

**วัตถุประสงค์**  
ทดสอบระบบยืนยันตัวตนและการให้สิทธิ์

### ขั้นตอนการทดสอบ
1. ทดสอบการเข้าถึงหน้าต่าง ๆ โดยไม่ login  
2. ทดสอบการใช้ **invalid JWT token**  
3. ทดสอบการ **expire ของ token**

### บันทึกผลการทดสอบ

| การทดสอบ | URL/Action | ผลลัพธ์ | HTTP Status |
|---|---|---|---|
| No token | `/comments` POST |  |  |
| Invalid token | `/user/1` GET |  |  |
| Expired token | `/admin/users` |  |  |

### วิเคราะห์และความคิดเห็น
ความเห็นเกี่ยวกับระบบ authentication:
- การจัดการ token ที่เหมาะสม  
- Error messages ที่เหมาะสม  
- ความปลอดภัยของ session management  

---

# Part 4: การเปรียบเทียบและวิเคราะห์

## Security Features Comparison

เปรียบเทียบฟีเจอร์ด้านความปลอดภัย:

| ฟีเจอร์ | Vulnerable Version | Secure Version | ผลกระทบต่อความปลอดภัย |
|---|---|---|---|
| SQL Injection Protection | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |
| XSS Protection | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |
| IDOR Protection | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |
| Rate Limiting | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |
| Input Validation | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |
| Error Handling | ปลอดภัย  /  ไม่ปลอดภัย | ปลอดภัย  /  ไม่ปลอดภัย |  |
| Authentication | ○ มี  ○ ไม่มี | ○ มี  ○ ไม่มี |  |

---

# Part 5: การวิเคราะห์และข้อเสนอแนะ

## 5.1 ช่องโหว่ที่พบและผลกระทบ

**ช่องโหว่ความรุนแรงสูง:**  
1. ________________________________  
   - ผลกระทบ: _____________________  
   - ความเสี่ยง: ____________________  
2. ________________________________  
   - ผลกระทบ: _____________________  
   - ความเสี่ยง: ____________________  

**ช่องโหว่ความรุนแรงปานกลาง:**  
1. ________________________________  
   - ผลกระทบ: _____________________  
   - ความเสี่ยง: ____________________  
2. ________________________________  
   - ผลกระทบ: _____________________  
   - ความเสี่ยง: ____________________  

## 5.2 วิธีการป้องกันที่มีประสิทธิภาพ (Top 3)

1. ________________________________  
   เหตุผล: _________________________  
2. ________________________________  
   เหตุผล: _________________________  
3. ________________________________  
   เหตุผล: _________________________  

## 5.3 ข้อเสนอแนะสำหรับการพัฒนา

**สำหรับ Developer:**  
1. ________________________________  
2. ________________________________  
3. ________________________________  

**สำหรับ Security Team:**  
1. ________________________________  
2. ________________________________  
3. ________________________________  

**สำหรับ Management:**  
1. ________________________________  
2. ________________________________  
3. ________________________________  

---

# Part 6: สรุปและบทเรียน

## 6.1 สิ่งที่เรียนรู้

**ด้านเทคนิค:**  
- ________________________________  
- ________________________________  
- ________________________________  

**ด้านกระบวนการ:**  
- ________________________________  
- ________________________________  
- ________________________________  

**ด้าน Business Impact:**  
- ________________________________  
- ________________________________  
- ________________________________  

## 6.2 ความท้าทายที่พบ

ในการทดสอบ:  
1. ________________________________  
   แก้ไขโดย: _______________________  
2. ________________________________  
   แก้ไขโดย: _______________________
---

## 6.3 การประยุกต์ใช้ในอนาคต

**ในการพัฒนาโปรเจค:**  
1. ________________________________  
2. ________________________________  
3. ________________________________  

**ในการทำงาน:**  
1. ________________________________  
2. ________________________________  
3. ________________________________  

---

## คะแนนการประเมินตนเอง

| หัวข้อ                          | คะแนนเต็ม | คะแนนที่ได้ | หมายเหตุ |
|---------------------------------|:---------:|:-----------:|----------|
| การทดสอบ Vulnerable Version     | 25        |             |          |
| การทดสอบ Secure Version         | 25        |             |          |
| การวิเคราะห์และเปรียบเทียบ     | 20        |             |          |
| การเขียนรายงาน                 | 15        |             |          |
| ความคิดสร้างสรรค์              | 15        |             |          |
| **รวม**                         | **100**   |             |          |

**ความคิดเห็นเพิ่มเติม:**  
เขียนความคิดเห็นส่วนตัวเกี่ยวกับผลแล็บ:  
- สิ่งที่ทำได้ดี  
- สิ่งที่อยากให้ปรับปรุง  
- ข้อเสนอแนะในการปรับปรุง  
- การนำไปใช้ในชีวิตจริง  

---

## ภาคผนวก

### A. Screenshots หลักฐาน
(แนบ screenshots ของการทดสอบในแต่ละขั้นตอน)  
ตัวอย่างการแทรกภาพ:
```md
![TC1.1](docs/screenshots/tc1-1.png)
![TC1.2](docs/screenshots/tc1-2.png)
![TC1.3](docs/screenshots/tc1-3.png)
```
> โปรดสร้างโฟลเดอร์ `docs/screenshots/` และใส่ไฟล์ภาพตามชื่อที่อ้างอิง

### B. Code Snippets ที่สำคัญ
(แนบโค้ดส่วนที่เกี่ยวกับการป้องกัน/ช่องโหว่ที่พบ)

ตัวอย่างบล็อกโค้ด (Prepared Statement):
```js
// Example (Node.js + mysql2)
const [rows] = await db.execute(
  'SELECT * FROM users WHERE username = ? AND password = ?',
  [username, hashedPassword]
);
```

### C. เอกสารอ้างอิง
- OWASP Top 10: https://owasp.org/Top10/
- Security Testing Guide: https://owasp.org/www-project-web-security-testing-guide/
- Lab Materials: [ระบุแหล่งที่มา]


